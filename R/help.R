
##' View example workflow assets
##' 
##' This function copies files out of the yspec install directory and into 
##' the directory of your choosing.  
##' 
##' @param output the directory where assets should be copied
##' @param overwrite passed to [file.copy]
##' 
##' @details
##' - `analysis1.yml`: an example yaml file
##' - `analysis1.csv`: data set that works with `analysis1.yml`
##' - `ysdb_internal.yml`: the internal column lookup data base
##' - `ys_example.Rmd`: contains testing code that utilizes other assets
##' - `ys_get_assets.md`: a listing of assets that is exported
##' 
##' @examples
##' ys_get_assets("yspec_stuff")
##' 
##' 
##' @md
##' @export
ys_get_assets <- function(output,overwrite=FALSE) {
  output <- normalPath(output, mustWork=FALSE)
  if(!overwrite) {
    if(dir.exists(output)) {
      stop(
        "The output directory already exists; remove it or use ", 
        "overwrite=TRUE", call.=FALSE
      )
    }
  }
  if(!dir.exists(output)) dir.create(output)
  cp <- function(...) {
    file.copy(system.file(..., package = "yspec"), output, overwrite=overwrite)  
  }
  a <- cp("internal", "analysis1.yml")
  b <- cp("internal", "ysdb_internal.yml")
  c <- cp("internal", "ys_get_assets.md")
  d <- cp("internal", "analysis1.csv")
  e <- cp("internal", "ys_example.Rmd")
  return(a&b&c&d&e)  
}

##' View example specification file
##' 
##' Open up either an example data specification file or the `yspec`
##' internal data base file. 
##' 
##' @param file the example specification file to view
##' 
##' @details
##' The specification file will be copied out of the yspec install 
##' location and into a temporary file.  That file will be opened as a regular
##' file in case `rstudioapi` is installed.  Otherwise, the file is opened
##' for viewing using [file.show].
##' 
##' @examples
##' \dontrun{
##' ys_view()
##' ys_view_db()
##' }
##' 
##' @export
ys_view <- function(file = "analysis1.yml") {
  file <- system.file("internal", file, package = "yspec")
  tmp <- file.path(tempdir(),paste0("view_",basename(file)))
  file.copy(file,tmp)
  if(requireNamespace("rstudioapi")) {
    rstudioapi::navigateToFile(tmp)
  } else {
    file.show(file)  
  }
}

##' @rdname ys_view
##' @export
ys_view_db <- function() {
  ys_view(file="ysdb_internal.yml")  
}


##' Demonstration object
##' 
##' @details
##' - `file` is the file name and path of a demonstration yspec file
##' - `spec()` is a function that generates a yspec object from `file`
##' - `data()` is a function that generates a data set that can be checked 
##'   against `spec()`
##' - `csv` is the file name (and path) to the data set generated by `data()`
##' - `proj()` is a function that generates a project object that can be 
##'   rendered into a document
##'   
##' @examples
##' spec <- ys_demo$spec()
##' 
##' ys_demo$file
##' 
##' dat <- ys_demo$data()  
##' 
##' @md
##' @export
ys_demo <- new.env()

.onLoad <- function(libname, pkgname) {
  file <- system.file("internal", "analysis1.yml", package = "yspec")
  ys_demo[["file"]] <- file
  ys_demo[["csv"]] <- system.file("internal", "analysis1.csv", package = "yspec")
  ys_demo[["spec"]] <- function(...) {
    ys_load(file,...)
  }
  ys_demo[["proj"]] <- function() {
    load_proj_ex("project.yml")
  }
  ys_demo[["data"]] <- function() {
    read.csv(
      file=ys_demo[["csv"]],
      na.strings = '.', as.is=TRUE, stringsAsFactors=FALSE
    )    
  }
}


